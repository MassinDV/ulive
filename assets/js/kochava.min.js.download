!function(){var e,t=new i,o="identity-resolver.api.kochava.com";if("undefined"!=typeof window){var n=window.kochava;window.kochava=t}function i(){e=this}i.prototype.init=function(t,o,n,i,r,a){if(e.startTime=t,e.appID=o,e.page_name=s(),e.useCookie=i||!1,e.verbose=n||!1,e.disableAutoInstall=a||!1,"object"==typeof r&&null!=r&&(e.customTraits=r),"undefined"!=typeof console&&void 0!==console.log?e.logging=!0:e.logging=!1,null!=o&&""!=o){e.utm=g("ko_click_id",o+"_click",e.useCookie);var c=g("kv_id","kv_id",e.useCookie);e.kvID=""==c?w(e.useCookie):c,""==c&&(e.disableAutoInstall||e.install())}},i.prototype.installWithIdentity=function(t,o){"object"==typeof t&&null!=t&&(e.customTraits=t),e.install(o)},i.prototype.getInstallSent=function(){var t=g("kv_install_sent","kv_install_sent",e.useCookie);return e.verbose&&e.logging&&console.log("kochava.getInstallSent() install sent: "+t),null!==t&&""!==t},i.prototype.identify=function(t,o){var n;if(""!=(n="string"==typeof t?JSON.stringify({custom_id:t}):JSON.stringify(t)||"")?(e.customTraits=n,v("c_trt",e.customTraits,e.useCookie)):e.customTraits=g("c_trt","c_trt",e.useCookie),""!=e.customTraits)try{var i={method:"POST",endpoint:"web-sdk.control.kochava.com/v1/cpi/identityLink.php",body:e.getIdentityPayload(e.customTraits),contentType:"application/json",retries:10,async:!0};e.verbose&&e.logging&&console.log("kochava.identify request: ",i),a(i,o)}catch(t){e.verbose&&e.logging&&console.log("kochava.identify error: ",t.message)}},i.prototype.submitCookieId=function(t,n,i,r,s,c){try{var l={method:"POST",endpoint:o+"/cookie/submit",body:{partner_cookie_id:t},contentType:"application/json",retries:10,async:s,appGuid:n,authCode:r,nonce:i,withCredentials:!0,secure:!0};e.verbose&&e.logging&&console.log("kochava.submitCookieId request: ",l),a(l,c)}catch(t){e.verbose&&e.logging&&console.log("kochava.submitCookieId error: ",t.message)}},i.prototype.getCookieId=function(t,n,i){try{var r={method:"GET",endpoint:o+"/cookie/retrieve",contentType:"application/json",retries:10,async:n,appGuid:t,withCredentials:!0,secure:!0};e.verbose&&e.logging&&console.log("kochava.getCookieId request: ",r),a(r,i)}catch(t){e.verbose&&e.logging&&console.log("kochava.getCookieId error: ",t.message)}},i.prototype.getMAID=function(t,n,i,r,s){try{var c={method:"GET",endpoint:o+"/maid/get",contentType:"application/json",retries:10,async:r,appGuid:t,authCode:i,nonce:n,withCredentials:!0,secure:!0};e.verbose&&e.logging&&console.log("kochava.getMAID request: ",c),a(c,s)}catch(t){e.verbose&&e.logging&&console.log("kochava.getMAID error: ",t.message)}},i.prototype.activity=function(t,o,n){t=t||"";try{"install"==t&&(v("kv_install_sent",String((new Date).getTime()),e.useCookie),e.verbose&&e.logging&&console.log("kochava.activity(install) install_sent: "+g("kv_install_sent","kv_install_sent")));var i={method:"POST",endpoint:"web-sdk.control.kochava.com/track/json",body:e.getPayload(t,o),contentType:"application/json",retries:10,async:!0};e.verbose&&e.logging&&console.log("kochava request: ",i),a(i,n)}catch(t){e.verbose&&e.logging&&console.log("kochava error: ",t.message)}},i.prototype.page=function(t,o,n){e.page_name=t||e.page_name,e.activity("page",o,n)},i.prototype.conversion=function(t,o,n){t=t||"",e.activity("conversion_"+t,o,n)},i.prototype.install=function(t){e.activity("install",null,t)},i.prototype.getKochavaId=function(){return e.kvID},i.prototype.getPayload=function(t,o){o=o||{};var n={kochava_app_id:e.appID,kochava_device_id:e.kvID,sdk_version:"2.2.0",data:{language:l(),device_orientation:p(),user_agent:c(),device_ids:{kochava_device_id:e.kvID}}};if("install"==t)n.action="install",null!==e.customTraits&&void 0!==e.customTraits&&(n.data.identity_link=e.customTraits);else if(n.action="event",n.data.event_name=t,n.data.event_data={page_name:e.page_name},"object"==typeof o)for(key in o)o.hasOwnProperty(key)&&(n.data.event_data[key]=o[key]);else null!=o&&e.verbose&&e.logging&&console.log("Unexpected type of options_array");if("page"!=t&&"install"!=t){var i=(new Date).getTime()-e.startTime;n.data.event_data.time_on_page=Math.round(i/1e3)}var r=u(),a=d();return null!=r&&(n.data.disp_w=r),null!=a&&(n.data.disp_h=a),"string"==typeof e.utm&&""!=e.utm&&(n.data.conversion_data={},n.data.conversion_data.utm_source=e.utm),n},i.prototype.getIdentityPayload=function(t){var o={kochava_app_id:e.appID,device_id:{kochava_device_id:e.kvID}};if(""!=t)try{o.data=JSON.parse(t)}catch(t){e.verbose&&e.logging&&console.log("Error parsing custom_trait JSON: ")}return o};var r,a=function(t,o){var n=t.method||"GET",i=t.endpoint,r=t.body||{},s=t.contentType||"application/json",c=t.retries,l=t.async||!1,u=t.withCredentials||!1;i="undefined"==typeof document||t.secure?"https://"+i:("https:"===document.location.protocol?"https://":"http://")+i,r="application/json"===s?JSON.stringify(r):r,"undefined"==typeof XMLHttpRequest&&(XMLHttpRequest=function(){try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(e){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}throw new Error("This browser does not support XMLHttpRequest.")});try{var d=new XMLHttpRequest;u&&(d.withCredentials=!0)}catch(t){return e.verbose&&e.logging&&console.log("Error completing request: ",t),void("function"==typeof o&&o(!0,null))}d.open(n,i,l),s&&d.setRequestHeader("Content-Type",s),t.authCode&&t.nonce&&t.appGuid?d.setRequestHeader("Authorization",t.appGuid+", "+t.nonce+", "+t.authCode):t.appGuid&&d.setRequestHeader("Authorization",t.appGuid),d.onerror=function(){if(--c>0){e.verbose&&e.logging&&console.log("Error: API call failed at the network level. Attempt:"+(10-c));var n=10-c;t.retries=c;var i=n*n*500;i>6e4&&(i=6e4),setTimeout(function(){a(t,o)},i)}else e.verbose&&e.logging&&console.log("Error: API call failed at the network level (retry limit hit)."),"function"==typeof o&&o(!0,null)},d.onload=function(n){if(200!=d.status&&204!=d.status){if(401==d.status&&(e.verbose&&e.logging&&console.log("unauthorzied request"),"function"==typeof o))return void o(!0,d.status);try{var i=(n=JSON.parse(d.responseText)).error,r=n.error_description}catch(e){}if(--c>0){e.verbose&&e.logging&&console.log("Error ("+d.status+")("+i+"): "+r);var s=10-c;t.retries=c;var l=s*s*500;l>6e4&&(l=6e4),setTimeout(function(){a(t,o)},l)}else e.verbose&&e.logging&&console.log("Error (retry limit hit) ("+d.status+")("+i+"): "+r),"function"==typeof o&&o(!0,n)}else if(e.verbose&&e.logging&&console.log("event sent successfully"),"function"==typeof o){try{n=JSON.parse(d.responseText)}catch(e){n=d.responseText}o(!1,n)}},d.send(r)},s=function(){var e="";return"undefined"!=typeof location&&(e=(e=location.pathname.substring(1)).replace(/\/+$/,"")),""==e?"/":e},c=function(){return"undefined"!=typeof navigator?navigator.userAgent:""},l=function(){return"undefined"!=typeof navigator?navigator.language:""},u=function(){return"undefined"!=typeof window?window.screen.availWidth:null},d=function(){return"undefined"!=typeof window?window.screen.availHeight:null},p=function(){return"undefined"!=typeof window?window.innerWidth<window.innerHeight?"portrait":"landscape":""},g=function(e,t,o){var n=_(e);if(""==n?n=f(t):v(t,n,o),o){if(""!=n)return h(t,n),n;""!=(n=k(t))&&v(t,n,o)}return null===n?"":n},v=function(e,t,o){y(e,t),o&&h(e,t)},f=function(e){if("undefined"==typeof localStorage)return"";var t;try{t=localStorage.getItem(e)}catch(e){return""}return null===t?"":t},y=function(e,t){if("undefined"==typeof localStorage)return!1;try{localStorage.setItem(e,t)}catch(e){return!1}return!0},h=function(e,t){var o,n=new Date;n.setTime(n.getTime()+31536e7),o="; expires="+n.toUTCString(),document.cookie=e+"="+(t||"")+o+"; path=/;domain="+m()},k=function(e){for(var t=e+"=",o=document.cookie.split(";"),n=0;n<o.length;n++){for(var i=o[n];" "==i.charAt(0);)i=i.substring(1,i.length);if(0==i.indexOf(t))return i.substring(t.length,i.length)}return""},m=function(){try{return window.location.host.match(/[^\.]*\.[^.]*$/)[0]}catch(e){return window.location.host}},_=function(e){if("undefined"==typeof location||void 0===location.search)return"";e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(location.search);return null===t?"":decodeURIComponent(t[1].replace(/\+/g," "))},w=function(e){var t=b();return v("kv_id",t,e),t},b=function(){var e=(new Date).getTime();return"kwxxxxxxxxxxxxx".replace(/[xy]/g,function(t){var o=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?o:3&o|8).toString(16)})};if("undefined"!=typeof exports&&(exports.Kochava=i),n)for(;args=n.shift();){var T=args.shift();(r=t[T])&&r.constructor&&r.call&&r.apply&&t[T].apply(this,args)}}();